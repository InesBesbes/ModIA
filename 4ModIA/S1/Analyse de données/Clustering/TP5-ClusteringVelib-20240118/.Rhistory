install.packages("leaflet")
install.packages("terra")
library(knitr)
## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
cache=FALSE,
prompt=FALSE,
tidy=TRUE,
comment=NA,
message=FALSE,
warning=FALSE,
class.source="badCode")
opts_knit$set(width=75)
library(funFEM)
library(reshape2)
library(ggplot2)
library(gridExtra)
library(FactoMineR)
library(factoextra)
library(corrplot)
library(mclust)
library(stringr)
library(cluster)
library(clusterSim)
library(leaflet)
install.packages("leaflet")
library(funFEM)
library(reshape2)
library(ggplot2)
library(gridExtra)
library(FactoMineR)
library(factoextra)
library(corrplot)
library(mclust)
library(stringr)
library(cluster)
library(clusterSim)
library(leaflet)
library(knitr)
## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
cache=FALSE,
prompt=FALSE,
tidy=TRUE,
comment=NA,
message=FALSE,
warning=FALSE,
class.source="badCode")
opts_knit$set(width=75)
library(funFEM)
library(reshape2)
library(ggplot2)
library(gridExtra)
library(FactoMineR)
library(factoextra)
library(corrplot)
library(mclust)
library(stringr)
library(cluster)
library(clusterSim)
library(leaflet)
library(funFEM)
data(velib)
Velibdata<-velib$data[,-c(1:13)]
colnames(Velibdata)<-velib$dates[-c(1:13)]
day<-str_sub(colnames(Velibdata), 1, 3)
day<-factor(day, levels = c("Lun","Mar","Mer","Jeu","Ven","Sam","Dim"))
table(day)
hour<-str_sub(colnames(Velibdata),5,6)
table(hour)
timeTick <- 24*(0:6)
station<- read.table("InfoStationsVelib.txt",header=T)
plotprofils<-function(Velibdata,station,numstation,plotsem=TRUE){
# Velibdata = les données de velib initiales
# station = ens. des informations sur les stations
# numstation = vecteur contenant le numéro de ligne des stations dont on souhaite tracer les profils
library(reshape2)
library(ggplot2)
Dataaux<-data.frame(id.s=station$nom,Velibdata)
Aux<-melt(Dataaux[numstation,],id = c("id.s"))
Aux<-data.frame(Aux,day=str_sub(Aux$variable,1,3),hour=as.numeric(str_sub(Aux$variable,5,6)))
Aux$day<-factor(Aux$day, levels = c("Lun","Mer","Mar","Sam","Jeu","Dim","Ven"))
if (plotsem==TRUE){
g<-ggplot(Aux,aes(x=hour,y=value,col=id.s))+
geom_line()+
facet_wrap(~day,ncol=2)+
xlab("Time")+ylab("Loading")+
scale_x_continuous(breaks=seq(0,24,4))+
theme(legend.position = "bottom")+theme(axis.title.x = element_blank())+
labs(col = "Classif.")+
scale_x_continuous(breaks=c(0,7,9,12,14,20,24))
}else{
v<-rep(0,nrow(Aux))
for (j in 1:length(levels(Aux$day)))
v[which(Aux$day==levels(Aux$day)[j])]<-Aux$hour[which(Aux$day==levels(Aux$day)[j])] + (24*(j-1))
Aux<-data.frame(Aux,v=v)
rect<-data.frame(xmin=timeTick,xmax=timeTick+23,ymin=rep(0,7),ymax=rep(1,7),color=rainbow(n=7))
g<-ggplot(data=Aux)+
geom_line(data=Aux,aes(x=v,y=value,col=id.s))+
geom_rect(data=rect,aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax, fill=color),show.legend=FALSE,alpha=0.1)+
xlab("Time")+ylab("Loading")+
theme(legend.position = "bottom")+
theme(axis.title.x = element_blank())+
labs(col = "Classif.")+
scale_x_continuous(breaks=rep(seq(0,21,3),7) + rep(24*(0:6),each=4),labels = rep(seq(0,21,3),7))
}
return(g)
}
plotprofils(Velibdata,station,numstation=c(813,655,468))
plotprofils(Velibdata,station,numstation=c(813,655,468),plotsem=FALSE)
plotprofilsmoy<-function(Velibdata,clustering,plotsem=TRUE){
library(reshape2)
library(ggplot2)
Dataaux<-matrix(0,nrow=max(clustering),ncol=ncol(Velibdata))
for (k in 1:max(clustering)){
Dataaux[k,]<-apply(Velibdata[which(clustering==k),],2,mean)
}
colnames(Dataaux)<-colnames(Velibdata)
Dataaux<-data.frame(id.s=as.factor(1:max(clustering)),Dataaux)
Aux<-melt(Dataaux,id = c("id.s"))
Aux<-data.frame(Aux,day=str_sub(Aux$variable,1,3),hour=as.numeric(str_sub(Aux$variable,5,6)))
Aux$day<-factor(Aux$day, levels = c("Lun","Mer","Mar","Sam","Jeu","Dim","Ven"))
if(plotsem==TRUE){
g<-ggplot(Aux,aes(x=hour,y=value,col=id.s))+
geom_line()+
facet_wrap(~day,ncol=2)+xlab("Time")+ylab("Loading")+
ylim(0,1)+
theme(legend.position = "bottom")+
theme(axis.title.x = element_blank())+
labs(col = "Classif.")+
scale_x_continuous(breaks=c(0,7,9,12,14,20,24))
}
else{
v<-rep(0,nrow(Aux))
for (j in 1:length(levels(Aux$day)))
v[which(Aux$day==levels(Aux$day)[j])]<-Aux$hour[which(Aux$day==levels(Aux$day)[j])] + (24*(j-1))
Aux<-data.frame(Aux,v=v)
rect<-data.frame(xmin=timeTick,xmax=timeTick+23,ymin=rep(0,7),ymax=rep(1,7),color=rainbow(n=7))
g<-ggplot(data=Aux)+
geom_line(data=Aux,aes(x=v,y=value,col=id.s))+
geom_rect(data=rect,aes(xmin = xmin, xmax = xmax, ymin = ymin, ymax = ymax, fill=color),show.legend=FALSE,alpha=0.1)+
xlab("Time")+ylab("Loading")+
ylim(0,1)+
theme(legend.position = "bottom")+
theme(axis.title.x = element_blank())+
labs(col = "Classif.")+
scale_x_continuous(breaks=rep(seq(0,21,3),7) + rep(24*(0:6),each=4),labels = rep(seq(0,21,3),7))
}
return(g)
}
plotprofilsmoy(Velibdata,clustering=station$colline+1,plotsem=TRUE)
plotprofilsmoy(Velibdata,clustering=station$colline+1,plotsem=FALSE)
stationcaract<-function(station,clustering){
library(dplyr)
#Dataaux<-data.frame(id.s=c(1:nrow(Data)),station)
#aux <- cbind(Dataaux, clust)
aux<-cbind(station,clustering)
aux.long <- melt(data.frame(lapply(aux[,-c(2:3)],as.character)),stringsAsFactors=FALSE, id = c("nom", "clustering"), factorsAsStrings=T)
# Effectifs
aux.long.q <- aux.long %>%
group_by(clustering, variable, value) %>%
mutate(count = n_distinct(nom)) %>%
distinct(clustering, variable, value, count)
# avec fréquences
aux.long.p <- aux.long.q %>%
group_by(clustering, variable) %>%
mutate(perc = count / sum(count)) %>%
arrange(clustering)
gaux<-ggplot(data=aux.long.p, aes(x=clustering, y=perc, fill=value)) +
geom_bar(stat="identity")+facet_wrap(~variable)
return(gaux)
}
plotmapquanti<-function(dataposition,varquanti){
library(leaflet)
pal <- colorNumeric(palette = "RdYlBu",domain = varquanti)
leaflet(dataposition) %>%
addTiles() %>%
addCircleMarkers(radius = 3,color = pal(varquanti),stroke = FALSE, fillOpacity = 1)%>%
addLegend("bottomright", pal = pal, values = varquanti,
opacity = 1)
}
plotmapquanti(dataposition=velib$position,varquanti=rowMeans(Velibdata))
plotmapquali<-function(dataposition,varquali){
library(leaflet)
factpal <- colorFactor(topo.colors(nlevels(varquali)), varquali)
leaflet(dataposition) %>%
addTiles() %>%
addCircleMarkers(radius = 3,color = factpal(varquali),stroke = FALSE, fillOpacity = 0.9)%>%
addLegend("bottomright", pal = factpal, values = varquali, opacity = 1)
}
plotmapquali(dataposition=velib$position,varquali=as.factor(station$colline))
library(corrplot)
timeTickAux<-c(timeTick,168)
for (k in 1:7)
corrplot(cor(Velibdata[,(timeTickAux[k]+1):(timeTickAux[k+1])]),method="ellipse")
velibmeanday<-matrix(0,nrow=nrow(Velibdata),ncol=7)
for (k in 1:7){
velibmeanday[,k] <- apply(Velibdata[,(timeTickAux[k]+1):(timeTickAux[k+1])],1,mean)
}
colnames(velibmeanday)<-c("Lun","Mar","Mer","Jeu","Ven","Sam","Dim")
ggplot(melt(velibmeanday),aes(x=Var2,y=value))+geom_boxplot()+xlab("")+ylab("Loading")
velibHour <- data.frame(value=colMeans(Velibdata),day=day,hour=as.numeric(hour))
ggplot(velibHour,aes(x=hour,y=value,col=day))+
geom_line()+geom_point()+
ylab("Loading")+ggtitle("Hourly loading, averaged over all stations")
plotmapquanti(velib$position,rowMeans(Velibdata))
t<-0
loadheure  <- rowMeans(Velibdata[, seq(from = (t+1),  by = 24, length = 7)])
plotmapquanti(velib$position,loadheure)
plotmapquali(velib$position,as.factor(station$colline))
plotmapquali(velib$position,as.factor(station$tourisme))
#velibquant<-velib$data[,c(1:13)]
respca<-PCA(velib$data)
fviz_eig(....)
respca<-PCA(Velibdata)
fviz_eig(....)
respca<-PCA(Velibdata, scale.unit = TRUE, graph = FALSE)
fviz_eig(....)
respca<-PCA(Velibdata, scale.unit = TRUE, graph = FALSE, ncp=168)
fviz_eig(respca)
fviz_pca_var(respca)
fviz_pca_ind(respca)
velibacp<-respca$ind$coord[,1:7]
respca<-PCA(Velibdata, scale.unit = TRUE, graph = FALSE, ncp=168)
fviz_eig(respca)
fviz_pca_var(respca, axes=c(1,2), geom = c("arrow"), col.var = hour)
fviz_pca_ind(respca)
reskmeans<-kmeans(velibacp, centers = 3)
respca<-PCA(Velibdata, scale.unit = TRUE, graph = FALSE, ncp=168)
fviz_eig(respca)
fviz_pca_var(respca, axes=c(1,2), geom = c("arrow"), col.var = hour)
fviz_pca_ind(respca, habillage = as.factor(station$colline))
reskmeans<-kmeans(velibacp, centers = 3)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
fviz_pca_ind(velibacp, col.ind = as.factor(reskmeans$cluster), geom=c("point"), axes = c(1,2))
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(Velibdata),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
resaux<-kmeans(velibacp, centers = k)
reskmeanscl[,k-1]<-resaux$cluster
Iintra<-c(Iintra,resaux$tot.withinss)
}
df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+geom_line()+geom_point()+xlab("Nombre de classes")+ylab("Inertie intraclasse")
reskmeans<-kmeans(velibacp, centers = 5)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
fviz_pca_ind(velibacp, col.ind = as.factor(reskmeans$cluster), geom=c("point"), axes = c(1,2))
reskmeans<-kmeans(velibacp, centers = 5)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
#fviz_pca_ind(velibacp, col.ind = as.factor(reskmeans$cluster), geom=c("point"), axes = c(1,2))
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(velibacp,ncol=Kmax-1)
Iintra<-NULL
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(velibacp),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
resaux<-kmeans(velibacp, centers = k)
reskmeanscl[,k-1]<-resaux$cluster
Iintra<-c(Iintra,resaux$tot.withinss)
}
df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+geom_line()+geom_point()+xlab("Nombre de classes")+ylab("Inertie intraclasse")
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(Velibdata),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
resaux<-kmeans(velibacp, centers = k)
reskmeanscl[,k-1]<-resaux$cluster
Iintra<-c(Iintra,resaux$tot.withinss)
}
df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+geom_line()+geom_point()+xlab("Nombre de classes")+ylab("Inertie intraclasse")
reskmeans<-kmeans(velibacp, centers = 5)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
fviz_pca_ind(velibacp, col.ind = as.factor(reskmeans$cluster), geom=c("point"), axes = c(1,2))
reskmeans<-kmeans(velibacp, centers = 5)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
fviz_pca_ind(velibacp, col.ind = reskmeans$cluster, geom=c("point"), axes = c(1,2))
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(velibacp),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
resaux<-kmeans(velibacp, centers = k)
reskmeanscl[,k-1]<-resaux$cluster
Iintra<-c(Iintra,resaux$tot.withinss)
}
df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+geom_line()+geom_point()+xlab("Nombre de classes")+ylab("Inertie intraclasse")
velibacp<-respca$ind$coord[,1:7]
velibacp
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(velibacp),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
resaux<-kmeans(velibacp, centers = k)
reskmeanscl[,k-1]<-resaux$cluster
Iintra<-c(Iintra,resaux$tot.withinss)
}
df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+geom_line()+geom_point()+xlab("Nombre de classes")+ylab("Inertie intraclasse")
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(velibacp),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
resaux<-kmeans(velibacp, centers = k)
reskmeanscl[,k-1]<-resaux$cluster
Iintra<-c(Iintra,resaux$tot.withinss)
}
df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+geom_line()+geom_point()+xlab("Nombre de classes")+ylab("Inertie intraclasse")
reskmeans<-kmeans(velibacp, centers = 5)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
#$cluster), geom=c("point"), axes = c(1,2))
reskmeans<-kmeans(velibacp, centers = 4)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
#$cluster), geom=c("point"), axes = c(1,2))
reskmeans<-kmeans(velibacp, centers = 4)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
#$cluster), geom=c("point"), axes = c(1,2))
reskmeans<-kmeans(velibacp, centers = 4)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
#$cluster), geom=c("point"), axes = c(1,2))
respca<-PCA(Velibdata, scale.unit = TRUE, graph = FALSE, ncp=168)
fviz_eig(respca)
fviz_pca_var(respca, axes=c(1,2), geom = c("arrow"), col.var = hour)
fviz_pca_ind(respca, habillage = as.factor(station$colline))
velibacp<-respca$ind$coord[,1:7]
velibacp
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(velibacp),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
resaux<-kmeans(velibacp, centers = k)
reskmeanscl[,k-1]<-resaux$cluster
Iintra<-c(Iintra,resaux$tot.withinss)
}
df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+geom_line()+geom_point()+xlab("Nombre de classes")+ylab("Inertie intraclasse")
reskmeans<-kmeans(velibacp, centers = 4)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"))+ggtitle("")
#$cluster), geom=c("point"), axes = c(1,2))
reskmeans<-kmeans(velibacp, centers = 4)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"), axes = c(1,2))+ggtitle("")
#$cluster), geom=c("point"), axes = c(1,2))
reskmeans<-kmeans(velibacp, centers = 4)
fviz_cluster(reskmeans, data = velibacp, ellipse.type = "norm", labelsize = 8, geom = c("point"), axes = c(1,2))+ggtitle("")
#$cluster), geom=c("point"), axes = c(1,2))
# A COMPLETER
d = dist(Velibdata, "euclidian")
hclustsingle<-hclust(d, method = "single")
hclustcomplete<-hclust(d, method = "complete")
hclustaverage<-hclust(d, method = "average")
# Dendrogramme
plot(hclustsingle,hang=-1,labels=FALSE)
fviz_dend(hclustsingle,show_labels=FALSE)
plot(hclustcomplete,hang=-1,labels=FALSE)
fviz_dend(hclustcomplete,show_labels=FALSE)
plot(hclustaverage,hang=-1,labels=FALSE)
fviz_dend(hclustaverage,show_labels=FALSE)
# A COMPLETER
d = dist(velibacp, "euclidian")
hclustsingle<-hclust(d, method = "single")
hclustcomplete<-hclust(d, method = "complete")
hclustaverage<-hclust(d, method = "average")
# Dendrogramme
plot(hclustsingle,hang=-1,labels=FALSE)
fviz_dend(hclustsingle,show_labels=FALSE)
plot(hclustcomplete,hang=-1,labels=FALSE)
fviz_dend(hclustcomplete,show_labels=FALSE)
plot(hclustaverage,hang=-1,labels=FALSE)
fviz_dend(hclustaverage,show_labels=FALSE)
ClassK3 = cutree(hclustcomplete,k=3)
ClassK3 = cutree(hclustcomplete,k=3)
table(cutree(hclustcomplete,k=3))
df<-data.frame(Velibdata,Class=as.factor(ClassK3))
df<-melt(df,id="Class")
ggplot(df,aes(x=variable,y=value))+geom_violin(aes(fill=Class))
ClassK3 = cutree(hclustcomplete,k=3)
table(cutree(hclustcomplete,k=3))
df<-data.frame(velibacp,Class=as.factor(ClassK3))
df<-melt(df,id="Class")
ggplot(df,aes(x=variable,y=value))+geom_violin(aes(fill=Class))
plotprofilsmoy(Velibdata, reskmeans)
# A COMPLETER
d = dist(velibacp, "ward")
# A COMPLETER
d = dist(velibacp, "wald")
# A COMPLETER
d = dist(velibacp, "euclidian")
hclustsingle<-hclust(d, method = "single")
hclustcomplete<-hclust(d, method = "complete")
hclustaverage<-hclust(d, method = "average")
# Dendrogramme
plot(hclustsingle,hang=-1,labels=FALSE)
fviz_dend(hclustsingle,show_labels=FALSE)
plot(hclustcomplete,hang=-1,labels=FALSE)
fviz_dend(hclustcomplete,show_labels=FALSE)
plot(hclustaverage,hang=-1,labels=FALSE)
fviz_dend(hclustaverage,show_labels=FALSE)
res<-Mclust(Velibdata, G=3)
table(res$classification, labeltrue)
res<-Mclust(Velibdata, G=3)
table(res$classification, labeltrue)
# A COMPLETER
d = dist(velibacp, "euclidian")
hclustsingle<-hclust(d, method = "single")
hclustcomplete<-hclust(d, method = "complete")
hclustaverage<-hclust(d, method = "average")
hclustward<-hclust(d, method = "ward.D2")
# Dendrogramme
plot(hclustsingle,hang=-1,labels=FALSE)
fviz_dend(hclustsingle,show_labels=FALSE)
plot(hclustcomplete,hang=-1,labels=FALSE)
fviz_dend(hclustcomplete,show_labels=FALSE)
# A COMPLETER
d = dist(velibacp, "euclidian")
hclustsingle<-hclust(d, method = "single")
hclustcomplete<-hclust(d, method = "complete")
hclustaverage<-hclust(d, method = "average")
hclustward<-hclust(d, method = "ward.D2")
# Dendrogramme
plot(hclustsingle,hang=-1,labels=FALSE)
fviz_dend(hclustsingle,show_labels=FALSE, k=5)
plot(hclustcomplete,hang=-1,labels=FALSE)
fviz_dend(hclustcomplete,show_labels=FALSE, k=5)
plot(hclustaverage,hang=-1,labels=FALSE)
fviz_dend(hclustaverage,show_labels=FALSE, k=5)
plot(hclustward,hang=-1,labels=FALSE)
fviz_dend(hclustward,show_labels=FALSE, k=5)
ClassK5 = cutree(hclustward,k=5)
table(cutree(hclustward,k=5))
df<-data.frame(velibacp,Class=as.factor(ClassK3))
df<-melt(df,id="Class")
ggplot(df,aes(x=variable,y=value))+geom_violin(aes(fill=Class))
res<-Mclust(Velibdata, G=3)
table(res$classification)
adjustedRandIndex(res$classification)
res<-Mclust(Velibdata, G=2:20)
res<-Mclust(velibacp, G=2:20)
table(res$classification)
res$z
res$parameters
res<-Mclust(velibacp, G=2:20)
table(res$classification, reskmeans)
res<-Mclust(velibacp, G=2:20)
fviz_mclust(res, what = "BIC")
fviz_mclust(res, what = "BIC")
fviz_cluster(res, data = velibacp, ellipse.type="norm", geom = "point") +ggtitle("")+theme(legend.position = "none")
VelibMean<-matrix(0,nrow=nrow(Velibdata),ncol=3*7)
for (jour in 1:7){
VelibMean[,3*(jour-1)+1]<-apply(Velibdata[,24*(jour-1)+c(1:8)],1,mean)
VelibMean[,3*(jour-1)+2]<-apply(Velibdata[,24*(jour-1)+c(9:21)],1,mean)
VelibMean[,3*(jour-1)+3]<-apply(Velibdata[,24*(jour-1)+c(22:24)],1,mean)
}
colnames(VelibMean)<-paste(rep(unique(day),each=3),"-",rep(c("0-7h","8h-20h","21-23h"),7),sep="")
timeTickAux<-c(timeTick,168)
for (k in 1:7)
corrplot(cor(VelibMean[,(timeTickAux[k]+1):(timeTickAux[k+1])]),method="ellipse")
timeTickAux<-c(timeTick,168)
for (k in 1:3)
corrplot(cor(VelibMean[,(timeTickAux[k]+1):(timeTickAux[k+1])]),method="ellipse")
for (k in 1:2)
timeTickAux<-c(timeTick,168)
for (k in 1:2)
corrplot(cor(VelibMean[,(timeTickAux[k]+1):(timeTickAux[k+1])]),method="ellipse")
corrplot(VelibMean)
cor(corrplot(VelibMean), method = "ellipse")
cor(corrplot(VelibMean), method = "ellipse")
corrplot(cor(VelibMean), method = "ellipse")
respca2<-PCA(VelibMean, scale.unit = TRUE, graph = FALSE, ncp=21)
fviz_eig(respca2)
fviz_pca_var(respca2, axes=c(1,2), geom = c("arrow"), col.var = hour)
respca2<-PCA(VelibMean, scale.unit = TRUE, graph = FALSE, ncp=21)
fviz_eig(respca2)
fviz_pca_var(respca2, axes=c(1,2), geom = c("arrow"), col.var = jour)
fviz_pca_ind(respca2, habillage = as.factor(station$colline))
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(velibmeanacp),ncol=Kmax-1)
respca2<-PCA(VelibMean, scale.unit = TRUE, graph = FALSE, ncp=21)
fviz_eig(respca2)
fviz_pca_var(respca2, axes=c(1,2), geom = c("arrow"), col.var = jour)
fviz_pca_ind(respca2, habillage = as.factor(station$colline))
velibmeanacp<-respca$ind$coord[,1:5]
Kmax<-15
reskmeanscl<-matrix(0,nrow=nrow(velibmeanacp),ncol=Kmax-1)
Iintra<-NULL
for (k in 2:Kmax){
resaux<-kmeans(velibmeanacp, centers = k)
reskmeanscl[,k-1]<-resaux$cluster
Iintra<-c(Iintra,resaux$tot.withinss)
}
df<-data.frame(K=2:15,Iintra=Iintra)
ggplot(df,aes(x=K,y=Iintra))+geom_line()+geom_point()+xlab("Nombre de classes")+ylab("Inertie intraclasse")
reskmeans2<-kmeans(velibmeanacp, centers = 4)
fviz_cluster(reskmeans, data = velibmeanacp, ellipse.type = "norm", labelsize = 8, geom = c("point"), axes = c(1,2))+ggtitle("")
#$cluster), geom=c("point"), axes = c(1,2))
basis<- create.fourier.basis(c(0, 167), nbasis=25)
fdobj <- smooth.basis(1:168,t(Velibdata),basis)$fd
resfunFEM <- funFEM(fdobj,K=10,model='AkjBk',init='kmeans',lambda=0,disp=TRUE)
df<-data.frame(proba=apply(resfunFEM$P,1,max),classif=as.factor(apply(resfunFEM$P,1,which.max)))
ggplot(df,aes(x=classif,y=proba))+geom_boxplot()
classifFEM<-apply(resfunFEM$P,1,which.max)
plotprofilsmoy(Velibdata,clustering=classifFEM,plotsem=FALSE)
plotprofilsmoy(Velibdata,clustering=classifFEM,plotsem=TRUE)
plotmapquali(velib$position,as.factor(classifFEM))
stationcaract(station,classifFEM)
table(resICL$classification,classifFEM)
table(resICL$classification,classifFEM)

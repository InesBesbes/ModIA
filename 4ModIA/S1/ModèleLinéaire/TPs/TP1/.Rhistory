install.packages(c("corrplot", "reshape2", "gridExtra", "tidyverse"))
install.packages(c("glmnet", "coefplot", "ggfortify", "plotly"))
setwd("~/Documents/4ModIA/S1/ModèleLinéaire/TPs/TP1")
library(knitr)
## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
cache=FALSE,
prompt=FALSE,
tidy=TRUE,
comment=NA,
message=FALSE,
warning=FALSE,
class.source="badCode")
opts_knit$set(width=75)
library(knitr)
## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
cache=FALSE,
prompt=FALSE,
tidy=TRUE,
comment=NA,
message=FALSE,
warning=FALSE,
class.source="badCode")
opts_knit$set(width=75)
library(ellipse)
library(leaps)
library(MASS)
library(corrplot)
library(glmnet)
library(coefplot)
library(ggplot2)
library(gridExtra)
library(ggfortify)
library(plotly)
library(reshape2)
ozone = read.table("Ozone.txt")
# A COMPLETER - Faire des stat descriptives des données
ozone$vent = as.factor(ozone$vent)
ozone$pluie = as.factor(ozone$pluie)
head(ozone)
summary(ozone)
boxplot(ozone)
barplot(ozone)
pairs(ozone)
help(barplot)
barplot(ozone$vent)
corrplot(cor(ozone))
corrplot(cor(ozone[:17]))
corrplot(cor(ozone[1:17]))
ozone[1]
corrplot(cor(ozone[1:17]))
corrplot(cor(ozone[1:17,]))
ozone[1:17]
ozone[1:17]
corrplot(cor(ozone[1,]))
corrplot(cor(ozone[1,:]))
corrplot(cor(ozone[,1:11]), method = "ellipse")
barplot(ozone[,:])
barplot(ozone[,])
barplot(ozone[,3])
barplot(ozone[,12:13])
barplot(ozone[,12])
barplot(ozone[,11])
barplot(ozone[,12])
barplot(as.matrix(ozone[,12]))
ggplot(ozone, aes(x=pluie)+ geom_bar() + ylab("")+ ggtitle("Effectifs"))
ggplot(ozone, aes(x=pluie))+ geom_bar() + ylab("")+ ggtitle("Effectifs"))
ggplot(ozone, aes(x=pluie))+ geom_bar() + ylab("")+ ggtitle("Effectifs")
ggplot(ozone, aes(x=vent))+ geom_bar() + ylab("")+ ggtitle("Effectifs")
x = ozone$maxO3
y = ozone$T12
plot(x,y)
y = ozone$maxO3
x = ozone$T12
plot(x,y)
y = ozone$maxO3
x = ozone$T12
plot(x,y, xlab = "Ozone", ylab = ="Concentration ozone maximale")
y = ozone$maxO3
x = ozone$T12
plot(x,y, xlab = "Ozone", ylab  ="Concentration ozone maximale")
ggplot(ozone,aes(x=T12,y=maxO3))+
geom_point()
reg.simple = lm(x~y, data = ozone)  # A COMPLETER
summary(reg.simple)
reg.simple = lm(y~x, data = ozone)  # A COMPLETER
summary(reg.simple)
reg.simple$coefficients
reg.simple$residuals
ggplot(ozone, aes(T12, maxO3))+
geom_point() +
geom_smooth(method=lm, se=TRUE)+
xlab("T12")+  ylab("maxO3")
plot(maxO3~T12,data=ozone,pch=20)
abline(reg.simple)
T12=seq(min(ozone[,"T12"]),max(ozone[,"T12"]),
length=100)
grillex<-data.frame(T12)
ICdte<-predict(reg.simple,new=grillex,
interval="confidence",level=0.95)
matlines(grillex$T12,cbind(ICdte),lty=c(1,2,2),
col="red")
plot(maxO3~T12,data=ozone,pch=20)
abline(reg.simple)
T12=seq(min(ozone[,"T12"]),max(ozone[,"T12"]),
length=100)
grillex<-data.frame(T12)
ICdte<-predict(reg.simple,new=grillex,
interval="confidence",level=0.95)
matlines(grillex$T12,cbind(ICdte),lty=c(1,2,2),
col="red")
autoplot(reg.simple,which=c(1,2,4),label.size=2)
temp_var = predict(reg.simple,
interval="prediction")
new_df = cbind(ozone, temp_var)
ggplot(new_df, aes(T12, maxO3))+
geom_point() +
geom_line(aes(y=lwr), color = "red",
linetype = "dashed")+
geom_line(aes(y=upr), color = "red",
linetype = "dashed")+
geom_smooth(method=lm, se=TRUE)+
xlab("T12")+
ylab("maxO3")
plot(maxO3~T12,data=ozone,pch=20)
ICprev<-predict(reg.simple,new=grillex,
interval="pred",level=0.95)
matlines(grillex$T12,cbind(ICprev),lty=c(1,2,2),
col="blue")
help("confint")
IC = confint(reg.simple)
IC
df1 = as.data.frame(
rbind(coefficients(reg.simple),
ellipse(reg.simple,level=0.95)))
colnames(df1) = c("intp", "slope")
ggplot(data=df1[-1,],aes(x=intp, y=slope))+
geom_path()+
annotate("rect",xmin=IC[1,1],xmax=IC[1,2],
ymin=IC[2,1],ymax=IC[2,2],fill="red",alpha=0.1)+
geom_point(data=df1[1,], aes(x=intp, y=slope),
pch=3)
ozone1 = ozone[,1:11]
ozone1 = ozone[,1:11]
ozone1 = ozone[,1:11]
y = ozone1$maxO3
reg.mul = lm(y~., data = ozone1) # A COMPLETER
resume.mul = summary(reg.mul)
summary(reg.mul)
autoplot(reg.mul,which=c(1,2,4),label.size=2)
z= ozone1$maxO3
reg.mul = lm(z~., data = ozone1) # A COMPLETER
resume.mul = summary(reg.mul)
summary(reg.mul)
reg.mul = lm(ozone1$maxO3~., data = ozone1) # A COMPLETER
resume.mul = summary(reg.mul)
summary(reg.mul)
reg.mul = lm(ozone1$maxO3~., data = ozone1) # A COMPLETER
resume.mul = summary(reg.mul)
summary(reg.mul)
autoplot(reg.mul,which=c(1,2,4),label.size=2)
autoplot(reg.mul,which=c(1,2),label.size=2)
help("regsubsets")
help("stepAIC")
choix=regsubsets(ozone1) # A COMPLETER
help("regsubsets")
choix=regsubsets(ozone1$maxO3~., data = ozone1, nvmax = 10,  method = "forward") # A COMPLETER
stepAIC(reg.mul, trace=T, direction = "backward", )
# A COMPLETER
choix=regsubsets(ozone1$maxO3~., data = ozone1, nvmax = 10,  method = "forward") # A COMPLETER
plot(choix, scale = "bic")
plot(choix, scale = "cp")
choix=regsubsets(ozone1$maxO3~., data = ozone1, nvmax = 10,  method = "forward")
plot(choix, scale = "bic")
plot(choix, scale = "Cp")
plot(choix, scale = "adjr2")
stepAIC(reg.mul, trace=T, direction = "backward")
choix=regsubsets(ozone1$maxO3~., data = ozone1, nvmax = 10,  method = "backward")
plot(choix, scale = "bic")
plot(choix, scale = "Cp")
plot(choix, scale = "adjr2")
stepAIC(reg.mul, trace=T, direction = "backward")
reg.fin=lm(maxO3~T12+Ne9+Vx9+maxO3v,data=ozone1)
summary(reg.fin)
anova(reg.fin,reg.mul)
choix=regsubsets(ozone1$maxO3~., data = ozone1, nvmax = 10,  method = "backward")
plot(choix, scale = "bic")
plot(choix, scale = "Cp")
plot(choix, scale = "adjr2")
stepAIC(reg.mul, trace=F, direction = "backward")
stepAIC(reg.multi,trace=T,direction="backward",k=log(nrow(fitness)))
choix=regsubsets(ozone1$maxO3~., data = ozone1, nvmax = 10,  method = "backward")
plot(choix, scale = "bic")
plot(choix, scale = "Cp")
plot(choix, scale = "adjr2")
stepAIC(reg.mul, trace=F, direction = "backward")
stepAIC(reg.multi,trace=T,direction="backward",k=log(nrow(ozone1)))
choix=regsubsets(ozone1$maxO3~., data = ozone1, nvmax = 10,  method = "backward")
plot(choix, scale = "bic")
plot(choix, scale = "Cp")
plot(choix, scale = "adjr2")
stepAIC(reg.mul, trace=F, direction = "backward")
stepAIC(reg.mul,trace=T,direction="backward",k=log(nrow(ozone1)))
tildeY=scale(ozone1[,1],center=T,scale=T)
tildeX=scale(ozone1[,-1],center=T,scale=T)
lambda_seq<-10^(seq(-4,4,0.01))
fitridge <- glmnet(...) # A completer
help("glmnet")
lambda_seq<-10^(seq(-4,4,0.01))
fitridge <- glmnet(tildeX, tildeY) # A completer
summary(fitridge)
lambda_seq<-10^(seq(-4,4,0.01))
fitridge <- glmnet(tildeX, tildeY, lambda_seq) # A completer
lambda_seq<-10^(seq(-4,4,0.01))
fitridge <- glmnet(tildeX, tildeY) # A completer
summary(fitridge)
lambda_seq<-10^(seq(-4,4,0.01))
fitridge <- glmnet(tildeX, tildeY) # A completer
summary(fitridge)
reg.fin=lm(maxO3~T12+Ne9+Vx9+maxO3v,data=ozone1)
#summary(reg.fin)
anova(reg.fin,reg.mul)
reg.fin=lm(maxO3~T12+Ne9+Vx9+maxO3v,data=ozone1)
summary(reg.fin)
anova(reg.fin,reg.mul)
library(knitr)
## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
cache=FALSE,
prompt=FALSE,
tidy=TRUE,
comment=NA,
message=FALSE,
warning=FALSE,
class.source="badCode")
opts_knit$set(width=75)
library(ellipse)
library(leaps)
library(MASS)
library(corrplot)
library(glmnet)
library(coefplot)
library(ggplot2)
library(gridExtra)
library(ggfortify)
library(plotly)
library(reshape2)
ozone = read.table("Ozone.txt")
# A COMPLETER - Faire des stat descriptives des données
ozone$vent = as.factor(ozone$vent)
ozone$pluie = as.factor(ozone$pluie)
head(ozone)
summary(ozone)
boxplot(ozone)
pairs(ozone)
corrplot(cor(ozone[,1:11]), method = "ellipse")
ggplot(ozone, aes(x=pluie))+ geom_bar() + ylab("")+ ggtitle("Effectifs")
ggplot(ozone, aes(x=vent))+ geom_bar() + ylab("")+ ggtitle("Effectifs")
y = ozone$maxO3
x = ozone$T12
plot(x,y, xlab = "Ozone", ylab  ="Concentration ozone maximale")
ggplot(ozone, aes(T12, maxO3))+
geom_point() + #points noirs
geom_smooth(method=lm, se=TRUE)+ #se = true : intervalle de confiance sinon juste droite
xlab("T12")+  ylab("maxO3")
IC = confint(reg.simple)
IC
ozone1 = ozone[,1:11]
# A COMPLETER
autoplot(reg.mul,which=c(1,2),label.size=2)
tildeY=scale(ozone1[,1],center=T,scale=T)
tildeX=scale(ozone1[,-1],center=T,scale=T)
# A COMPLETER
lambda_seq<-10^(seq(-4,4,0.01))
fitridge <- glmnet(tildeX, tildeY,alpha = 0, lambda = lambda_seq,family=c("gaussian"),intercept=F))
summary(fitridge)
lambda_seq<-10^(seq(-4,4,0.01))
fitridge <- glmnet(tildeX, tildeY,alpha = 0, lambda = lambda_seq,family=c("gaussian"),intercept=F)
summary(fitridge)
df=data.frame(lambda = rep(fitridge$lambda,ncol(tildeX)), theta=as.vector(t(fitridge$beta)),variable=rep(colnames(tildeX),each=length(fitridge$lambda)))
g1 = ggplot(df,aes(x=lambda,y=theta,col=variable))+
geom_line()+
theme(legend.position="bottom")+
scale_x_log10()
ggplotly(g1)
ridge_cv <- cv.glmnet(tildeX, tildeY,alpha = 0, lambda = lambda_seq,family=c("gaussian"),intercept=F) # A completer
best_lambda <- ridge_cv$lambda.min
df2=data.frame(lambda=ridge_cv$lambda,MSE=ridge_cv$cvm,cvup=ridge_cv$cvup,cvlo=ridge_cv$cvlo)
gmse<-ggplot(df2)+
geom_line(aes(x=lambda,y=MSE))+
geom_vline(xintercept = ridge_cv$lambda.min,col="red",linetype="dotted")+
geom_line(aes(x=lambda,y=cvup),col="blue",linetype="dotted")+
geom_line(aes(x=lambda,y=cvlo),col="blue",linetype="dotted")+
#xlim(c(0,ridge_cv$lambda.min+0.5))+
scale_x_log10()
ggplotly(gmse)
g1=g1 +
geom_vline(xintercept = best_lambda,linetype="dotted", color = "red")+
scale_x_log10()
df=data.frame(lambda = rep(fitridge$lambda,ncol(tildeX)), theta=as.vector(t(fitridge$beta)),variable=rep(colnames(tildeX),each=length(fitridge$lambda)))
g1 = ggplot(df,aes(x=lambda,y=theta,col=variable))+
geom_line()+
theme(legend.position="bottom")+
scale_x_log10()
ggplotly(g1)
ridge_cv <- cv.glmnet(tildeX, tildeY,alpha = 0, lambda = lambda_seq, nfolds = 10, type_measure = c("mse"), intercept=F)
best_lambda <- ridge_cv$lambda.min
df2=data.frame(lambda=ridge_cv$lambda,MSE=ridge_cv$cvm,cvup=ridge_cv$cvup,cvlo=ridge_cv$cvlo)
gmse<-ggplot(df2)+
geom_line(aes(x=lambda,y=MSE))+
geom_vline(xintercept = ridge_cv$lambda.min,col="red",linetype="dotted")+
geom_line(aes(x=lambda,y=cvup),col="blue",linetype="dotted")+
geom_line(aes(x=lambda,y=cvlo),col="blue",linetype="dotted")+
#xlim(c(0,ridge_cv$lambda.min+0.5))+
scale_x_log10()
ggplotly(gmse)
g1=g1 +
geom_vline(xintercept = best_lambda,linetype="dotted", color = "red")+
scale_x_log10()
g1=g1 +
geom_vline(xintercept = best_lambda,linetype="dotted", color = "red")+
scale_x_log10()*
g1
g1=g1 +
geom_vline(xintercept = best_lambda,linetype="dotted", color = "red")+
scale_x_log10()*
g1
g1=g1 + geom_vline(xintercept = best_lambda,linetype="dotted", color = "red")+scale_x_log10()*
g1
g1=g1 + geom_vline(xintercept = best_lambda,linetype="dotted", color = "red")+scale_x_log10()
g1
fitlasso <- glmnet(tildeX, tildeY,alpha = 1, lambda = lambda_seq,family=c("gaussian"),intercept=F) # A COMPLETER
summary(fitlasso)
df=data.frame(lambda = rep(fitlasso$lambda,ncol(tildeX)), theta=as.vector(t(fitlasso$beta)),variable=rep(colnames(tildeX),each=length(fitlasso$lambda)))
g3 = ggplot(df,aes(x=lambda,y=theta,col=variable))+
geom_line()+
theme(legend.position="bottom")+
scale_x_log10()
ggplotly(g3)
lasso_cv <- cv.glmnet(tildeX, tildeY,alpha = 1, lambda = lambda_seq,family=c("gaussian"),intercept=F)
best_lambda <-lasso_cv$lambda.min
lambda1se <- lasso_cv$lambda.1se
lasso_cv <- cv.glmnet(tildeX, tildeY,alpha = 1, lambda = lambda_seq,family=c("gaussian"),intercept=F)
best_lambda <-lasso_cv$lambda.min
lambda1se <- lasso_cv$lambda.1se
g3=g3 +
geom_vline(xintercept = best_lambda,linetype="dotted", color = "red")+
geom_vline(xintercept = lambda1se,linetype="dotted", color = "blue")+
scale_x_log10()
g3
# A COMPLETER
extract.coef(lasso_cv, lambda = "lambda.min")
extract.coef(lasso_cv, lambda = "lambda.lse")
extract.coef(lasso_cv, lambda = "lambda.1se")
# A COMPLETER
extract.coef(lasso_cv, lambda = "lambda.min")
fitEN <- glmnet(tildeX, tildeY,alpha = 2, lambda = lambda_seq,family=c("gaussian"),intercept=F)
df=data.frame(lambda = rep(fitEN$lambda,ncol(tildeX)), theta=as.vector(t(fitEN$beta)),variable=rep(c(colnames(tildeX)),each=length(fitEN$lambda)))
g4 = ggplot(df,aes(x=lambda,y=theta,col=variable))+
geom_line()+
theme(legend.position="bottom")+
scale_x_log10()
EN_cv <- cv.glmnet(tildeX, tildeY,alpha = 2, lambda = lambda_seq,family=c("gaussian"),intercept=F) # A COMPLETER
best_lambda <-EN_cv$lambda.min
g4=g4 + geom_vline(xintercept = best_lambda,linetype="dotted",
color = "red")
ggplotly(g4)
fitEN <- glmnet(tildeX, tildeY,alpha = 0.5, lambda = lambda_seq,family=c("gaussian"),intercept=F)
df=data.frame(lambda = rep(fitEN$lambda,ncol(tildeX)), theta=as.vector(t(fitEN$beta)),variable=rep(c(colnames(tildeX)),each=length(fitEN$lambda)))
g4 = ggplot(df,aes(x=lambda,y=theta,col=variable))+
geom_line()+
theme(legend.position="bottom")+
scale_x_log10()
regusuel=lm(...)  # A COMPLETER
df4=data.frame(x=rep(colnames(tildeX),4),
coef=c(as.vector(regusuel$coefficients),as.vector(coef(ridge_cv,s=ridge_cv$lambda.min)[-1]),as.vector(coef(lasso_cv)[-1]),as.vector(coef(EN_cv)[-1])),
reg=c(rep("reg.lin",ncol(tildeX)),rep("ridge",ncol(tildeX)),rep("lasso",ncol(tildeX)),rep("ElasticNet",ncol(tildeX))))
g5=ggplot(df4)+
geom_point(aes(x=x,y=coef,col=reg))
g5
fitEN <- glmnet(tildeX, tildeY,alpha = 0.5, lambda = lambda_seq,family=c("gaussian"),intercept=F)
df=data.frame(lambda = rep(fitEN$lambda,ncol(tildeX)), theta=as.vector(t(fitEN$beta)),variable=rep(c(colnames(tildeX)),each=length(fitEN$lambda)))
g4 = ggplot(df,aes(x=lambda,y=theta,col=variable))+
geom_line()+
theme(legend.position="bottom")+
scale_x_log10()
EN_cv <- cv.glmnet(tildeX, tildeY,alpha = 0.5, lambda = lambda_seq,family=c("gaussian"),intercept=F) # A COMPLETER
best_lambda <-EN_cv$lambda.min
g4=g4 + geom_vline(xintercept = best_lambda,linetype="dotted",
color = "red")
ggplotly(g4)
